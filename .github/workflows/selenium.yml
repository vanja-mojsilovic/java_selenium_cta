name: Run Selenium Login Test

on:
  workflow_dispatch:

jobs:
  login-test:
    runs-on: ubuntu-latest

    env:
      VANJA_GOOGLE_PASSWORD: ${{ secrets.VANJA_GOOGLE_PASSWORD }}
      DISPLAY: :99  

    steps:
    - name: Checkout code
      uses: actions/checkout@v4

    - name: Set up JDK
      uses: actions/setup-java@v4
      with:
        distribution: 'temurin'
        java-version: '17'

    - name: Install Chrome and Xvfb
      run: |
        sudo apt-get update
        sudo apt-get install -y wget unzip xvfb libxi6 libgconf-2-4
        wget https://dl.google.com/linux/direct/google-chrome-stable_current_amd64.deb
        sudo dpkg -i google-chrome-stable_current_amd64.deb || sudo apt-get -f install -y

    - name: Start virtual display
      run: |
        Xvfb :99 -screen 0 1920x1080x24 &

    - name: Run Selenium test
      run: |
        mvn clean compile exec:java -Dexec.mainClass=cta.tests.LoginTest
